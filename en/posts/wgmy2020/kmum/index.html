<!doctype html><html lang=en class=direction-ltr><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>WGMY2020 - RE - kmum - Amjad Alsharafi</title><meta name=keywords content="writeup,wgmy2020,reverse engineering,kernel"><meta name=description content="Writeup of the reversing challenge kmum in WGMY2020"><meta name=author content="Amjad"><link rel=canonical href=https://amjad50.github.io/en/posts/wgmy2020/kmum/><link href=https://amjad50.github.io/assets/css/stylesheet.min.3548bf7088b742bdd7541e77bb920f9081f681619ac21453daa6d61b81a5d818.css integrity="sha256-NUi/cIi3Qr3XVB53u5IPkIH2gWGawhRT2qbWG4Gl2Bg=" rel="preload stylesheet" as=style><link rel=apple-touch-icon href=https://amjad50.github.io/apple-touch-icon.png><link rel=icon href=https://amjad50.github.io/favicon.ico><meta name=generator content="Hugo 0.79.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','G-N62ZER16LZ','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="WGMY2020 - RE - kmum"><meta property="og:description" content="Writeup of the reversing challenge kmum in WGMY2020"><meta property="og:type" content="article"><meta property="og:url" content="https://amjad50.github.io/en/posts/wgmy2020/kmum/"><meta property="article:published_time" content="2020-12-06T09:15:50+03:00"><meta property="article:modified_time" content="2020-12-06T09:15:50+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="WGMY2020 - RE - kmum"><meta name=twitter:description content="Writeup of the reversing challenge kmum in WGMY2020"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"WGMY2020 - RE - kmum","name":"WGMY2020 - RE - kmum","description":"Third reverse engineering challenge in WGMY2020","keywords":["writeup","wgmy2020","reverse engineering","kernel"],"articleBody":"$ file * app.exe: PE32+ executable (console) x86-64, for MS Windows kmum.sys: PE32+ executable (native) x86-64, for MS Windows Introduction This time we are dealing with kernel drivers.\nI’ll be using Ghidra and x64dbg for static and dynamic analysis for this challenge.\n Note: It is advised to use kernel debugging, but I had some problems in my windows host so this solution is using static analysis and a small dynamic analysis (not kernel).\n Analysis kmum.sys is the driver and app.exe mostly will load the driver and call into it.\napp.exe analysis The main function is at FUN_140001940. And this time it looks like C++ binary, nice.\nThe main starts by printing some strings and taking the input from the user, then FUN_140001070 is called.\nFUN_140001070 analysis The function starts by opening the driver file \"\\\\\\\\.\\kmum\", if it fails it will first get the .sys file by calling FUN_140001780 and installing the driver from the service manager in the function FUN_140001270.\nFor FUN_140001270 it calls it with 0 in the 3rd argument to stop it and with 1 to start it again.\n I didn’t talk much about FUN_140001780 and FUN_140001270 because they are just bunch of API calls and have some logging, so they are easy to understand from the code.\n Going back to main, the most important part is:\nDeviceIoControl(DAT_1400067d8,0x222000,local_118,(DWORD)lVar6,local_128,1,local_124, (LPOVERLAPPED)0x0); Looking at the documentation for DeviceIoControl:\n DAT_1400067d8 is a global reference to the driver file. 0x222000 is the ioctl code. local_118 input buffer. lVar6 length of input buffer. local_128 output buffer. 1 max length of output buffer. local_124 length returned for output.  Lastly, the output buffer should have the result of the flag check. Now let’s go into the driver and see how the flag check is made.\nkmum.sys analysis  It’s good to look at simple kernel driver examples, to see the similarities and to ease analysis. here is a good simple driver we will be referencing.\n Drivers does not have main but have DriverEntry which should setup the driver.\nWhen looking at entry in Ghidra, two functions are being called FUN_14000602c (which seems not important for analysis), and FUN_140001000, which takes the first argument from entry. Ghidra didn’t detect the second argument from DriverEntry because it is not used.\nIn FUN_140001000 let’s change the parameter type to DRIVER_OBJECT.\n Note: if you don’t see DRIVER_OBJECT in Ghidra you can download data types archives from here.\n Here is the function:\nulonglong FUN_140001000(DRIVER_OBJECT *param_1) { uint local_48; ulonglong local_40; undefined8 local_38; undefined local_30 [16]; undefined local_20 [32]; local_38 = 0; DbgPrint(\"[*] DriverEntry Called.\\n\"); RtlInitUnicodeString(local_30,L\"\\\\Device\\\\kmum\"); RtlInitUnicodeString(local_20,L\"\\\\??\\\\kmum\"); local_48 = IoCreateDevice(param_1,0,local_30,0x22,0x100,0,\u0026local_38); if ((int)local_48  0) { DbgPrint(\"[*] There was some errors in creating device.\\n\"); } else { local_40 = 0; while (local_40  0x1b) { *(code **)(param_1-MajorFunction + local_40) = FUN_140001190; local_40 = local_40 + 1; } param_1-MajorFunction[2] = (PDRIVER_DISPATCH)0x140001190; *(code **)param_1-MajorFunction = FUN_140001190; param_1-MajorFunction[0xe] = (PDRIVER_DISPATCH)0x1400011d0; *(code **)\u0026param_1-DriverUnload = FUN_140001260; local_48 = IoCreateSymbolicLink(local_20,local_30); if ((int)local_48  0) { DbgPrint(\"Failed to create symbolic link (0x%08X)\\n\",(ulonglong)local_48); IoDeleteDevice(local_38); } } return (ulonglong)local_48; } First it creates the device using IoCreateDevice, then it sets the handler functions. Looks like FUN_140001190 is being used as handler to all major functions except for DriverUnload to FUN_140001260, and MajorFunction[0xe] to FUN_1400011d0.\nThe function for 0xe is IRP_MJ_DEVICE_CONTROL, which matches what app.exe calls. (DeviceIoControl).\n#define IRP_MJ_DEVICE_CONTROL 0x0e FUN_1400011d0 analysis The function first calls FUN_1400012b0, which looks like IoGetCurrentIrpStackLocation.\nThen it checks the ioctl code:\nstack_io = (PIO_STACK_LOCATION)FUN_1400012b0(param_2); if (*(int *)(stack_io-Parameters + 0x14) == 0x222000) { uVar1 = FUN_140001810((longlong)param_2); local_18 = (uint)uVar1; } Ghidra didn’t manage to correctly figure out offsets because IO_STACK_LOCATION contains unions, and its hard to analyse. So stack_io-Parameters + 0x14 is stack_io-Parameters.DeviceIoControl.IoControlCode.\nIf the code is good it goes to FUN_140001810 next:\nFUN_140001810 analysis Here is finally where the flag is checked.\nFirst it checks input and output buffer sizes:\nif ((*(int *)(stack_io-Parameters + 0xc) == 0x26) \u0026\u0026 (*(int *)(stack_io-Parameters + 4) == 1)) Which are Parameters.DeviceIoControl.OutputBufferLength and Parameters.DeviceIoControl.InputBufferLength respectively.\nFirst stage in checking is XORing and shifting the whole flag and checking for a result:\nxor_result = 0; counter = 0; while (counter  0x26) { xor_result = xor_result ^ (int)input[counter]  (sbyte)((ulonglong)counter % 0x20); counter = counter + 1; } if (xor_result == 0xb2b07026) If that passes, there is 3 more stages to go in functions: FUN_140001a90, FUN_1400015b0 and FUN_1400019b0.\nFUN_140001a90 analysis (stage 2) The simplified function code:\nlocal_18 = 0x10; do { switch(local_18) { case 0: if ((byte)(inp[0x1d] ^ inp[0x23] ^ inp[0x1e] ^ inp[0x1b]) == 0xb) { local_18 = 0x11; } else { local_18 = 3; } break; // ... trimmed  case 9: return 0; // ... trimmed  case 0x10: if (inp[7] == inp[0x1a]) { local_18 = 0x16; } else { local_18 = 9; } break; // ... trimmed  case 0x17: return 1; // ... trimmed  case 0x20: // ... trimmed  break; } } while(true); We can see that local_18 is state and we should go through all checks and reach state 0x17.\nThese are all checks:\ninp[7] == inp[0x1a] inp[0x23] ^ inp[0x24] ^ inp[0x1f] ^ inp[0x22] == 1 inp[0x1a] ^ inp[0x24] ^ inp[0x23] ^ inp[0x15] == 0x51 inp[0x1f] ^ inp[0x16] ^ inp[0x17] ^ inp[0x1b] == 0x55 inp[0x1e] ^ inp[0x19] ^ inp[0x16] ^ inp[0x22] == 6 inp[0x15] ^ inp[0x1d] ^ inp[0x18] ^ inp[0x1a] == 7 inp[0x19] ^ inp[0x17] ^ inp[0x24] == 0x6c inp[0x24] ^ inp[0x23] ^ inp[0x19] == 0x33 inp[0x1d] ^ inp[0x20] ^ inp[0x21] ^ inp[0x15] == 0x50 inp[0x19] ^ inp[0x1a] ^ inp[0x1e] ^ inp[0x22] == 6 inp[0x15] ^ inp[0x18] ^ inp[0x22] == 0x30 inp[0x1d] ^ inp[0x23] ^ inp[0x1e] ^ inp[0x1b] == 0xb inp[0x22] ^ inp[0x20] ^ inp[0x17] ^ inp[0x1e] == 6 inp[0x21] ^ inp[0x17] ^ inp[0x1a] ^ inp[0x23] == 0x5f inp[0x20] ^ inp[0x21] ^ inp[0x1e] == 0x62 inp[0x1b] ^ inp[0x1c] ^ inp[0x17] ^ inp[0x1e] == 2 FUN_1400015b0 analysis (stage 3) This is very similar to FUN_140001a90 in terms of state logic, but its much simpler and straight forward, these are the checks performed:\ninp[0] = 0xc2 * -0x6b + -0x73 inp[1] = 0xf2 * -0x6b + -0x73 inp[2] = 0x60 * -0x6b + -0x73 inp[3] = 0x3c * -0x6b + -0x73 inp[4] = 0xb6 * -0x6b + -0x73 inp[0x25] = 0x30 * -0x6b + -0x73 Which is \"wgmy{}\" part. so this is not very interesting.\nFUN_1400019b0 analysis (stage 4) longlong FUN_1400019b0(char *inp) { char cVar1; ulonglong uVar2; ulonglong uVar3; byte local_28; int counter; ulonglong local_10; local_10 = 0xf33df4c3c4feb33f; counter = 5; while( true ) { if (0x14  counter) { return 1; } uVar2 = FUN_1400020e0(\u0026local_10); uVar3 = FUN_1400020e0(\u0026local_10); FUN_1400012d0((int)uVar2); local_28 = 0; while (local_28  (byte)uVar3) { FUN_140001370(); local_28 = local_28 + 1; } uVar2 = FUN_140001370(); cVar1 = inp[counter]; uVar2 = FUN_140002010((byte)uVar2 \u0026 0xf); if (cVar1 != (char)uVar2) break; counter = counter + 1; } return 0; } FUN_1400020e0, FUN_1400012d0, FUN_140001370, and FUN_140002010 all are complex but independant of the input, and that means we can run debug this function and checks uVar2 at the end for every loop.\n Now, this could be debugged using windbg in kernel mode, but I got into problems with my windows host, so I struggled in the beginning of how to debug this, but then I found the solution.\n Debugging FUN_1400019b0 The good thing about this function and its internal functions is that it does not depend on the input or anything else in fact, it just uses global variables to store data and do its computation. Which means we can just start execution from here by editing the RIP (64bit Instruction Pointer) register.\nWhen trying to start kmum.sys in x64dbg it does not work as it is a kernel driver and not a normal executable.\nWe can fix this issue by editing the PE header and fooling x64dbg into believing this is a normal exe.\nConverting sys into exe Looking in the PE format, there is a byte to control the subsystem that this binary represent. The driver has subsystem value of 1, and the cli executable has value of 3.\nIn our file here, the offset is at 0x134, so we change that and we can run the driver now.\nWhen running the driver, first we continue until we reach the entry breakpoint and immediately change $rip to xxxxxxxxxxxx19B0.\nAfter that since this function expects a buffer as argument in rcx. We can allocate memory from x64dbg, put a flag in there (example: wgmy{aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa}) and put the address in rcx.\nNext, we continue until xxxxxxxxxxxx1A70:\n140001a70 cmp ecx,eax eax should have the correct character, for easier analysis we can patch the jump instruction after it to force it to jump. It now jumps if they are equal. all we need is convert jz into jmp.\n140001a72 jz LAB_140001a78 Then we just continue execution and record all 16 characters:\n62a7075ff72176ad Solution Now that we have all the pieces, stage 2, stage 4 and the xor thing. We can solve them using z3-solver, which is a theorem prover from Microsoft Research.\nI started by grouping all rules we collected and got this:\nfrom z3 import * inp = [BitVec(f'x{i}', 32) for i in range(0x26)] xor_thing = BitVec('xor', 32) s = Solver() for (i, inpp) in enumerate(inp): xor_thing = xor_thing ^ (inpp  (i % 0x20)) # because it a byte s.add(inpp = 0) s.add(inpp  0xFF) # stage 1 s.add(xor_thing == 0xb2b07026) # stage 2 s.add(inp[7] == inp[0x1a]) s.add(inp[0x23] ^ inp[0x24] ^ inp[0x1f] ^ inp[0x22] == 1) s.add(inp[0x1a] ^ inp[0x24] ^ inp[0x23] ^ inp[0x15] == 0x51) s.add(inp[0x1f] ^ inp[0x16] ^ inp[0x17] ^ inp[0x1b] == 0x55) s.add(inp[0x1e] ^ inp[0x19] ^ inp[0x16] ^ inp[0x22] == 6) s.add(inp[0x15] ^ inp[0x1d] ^ inp[0x18] ^ inp[0x1a] == 7) s.add(inp[0x19] ^ inp[0x17] ^ inp[0x24] == 0x6c) s.add(inp[0x24] ^ inp[0x23] ^ inp[0x19] == 0x33) s.add(inp[0x1d] ^ inp[0x20] ^ inp[0x21] ^ inp[0x15] == 0x50) s.add(inp[0x19] ^ inp[0x1a] ^ inp[0x1e] ^ inp[0x22] == 6) s.add(inp[0x15] ^ inp[0x18] ^ inp[0x22] == 0x30) s.add(inp[0x1d] ^ inp[0x23] ^ inp[0x1e] ^ inp[0x1b] == 0xb) s.add(inp[0x22] ^ inp[0x20] ^ inp[0x17] ^ inp[0x1e] == 6) s.add(inp[0x21] ^ inp[0x17] ^ inp[0x1a] ^ inp[0x23] == 0x5f) s.add(inp[0x20] ^ inp[0x21] ^ inp[0x1e] == 0x62) s.add(inp[0x1b] ^ inp[0x1c] ^ inp[0x17] ^ inp[0x1e] == 2) # stage 3 s.add(inp[0] == (0xc2 * -0x6b + -0x73) \u0026 0xFF) s.add(inp[1] == (0xf2 * -0x6b + -0x73) \u0026 0xFF) s.add(inp[2] == (0x60 * -0x6b + -0x73) \u0026 0xFF) s.add(inp[3] == (0x3c * -0x6b + -0x73) \u0026 0xFF) s.add(inp[4] == (0xb6 * -0x6b + -0x73) \u0026 0xFF) s.add(inp[0x25] == (0x30 * -0x6b + -0x73) \u0026 0xFF) # stage 4 for (i, c) in enumerate('62a7075ff72176ad'): s.add(inp[i + 5] == ord(c)) print(s.check()) m = s.model() print([m[inpp] for inpp in inp]) # this converts the int array to encoded string using a weird method, # this is due to not able to convert from BitVec into integer, BitVec is just # a reference print(bytes(eval(str([m[inpp] for inpp in inp]))))  Note: the reason we used BitVec(f'x{i}', 32) for each character instead of 8, is that BitVec of 8 bits in size cannot be shifted and converted into 32 bit.\n BUT, this gave us:\nwgmy{62a7075ff72176ad+afx(a+c5,y/ac9\"} And that means the constrains are not enough, so I thought of making the inside only in 0-9a-f.\n# only hex characters if i = 5 and i  0x24: s.add(Or(And(inpp = 0x30, inpp  0x39), And(inpp  0x66, inpp = 0x61))) This replaces:\n# because it a byte s.add(inpp = 0) s.add(inpp  0xFF) And we got the flag:\nwgmy{62a7075ff72176ad1afb2a1c56c5ac98} ","wordCount":"1880","inLanguage":"en","datePublished":"2020-12-06T09:15:50+03:00","dateModified":"2020-12-06T09:15:50+03:00","author":{"@type":"Person","name":"Amjad"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://amjad50.github.io/en/posts/wgmy2020/kmum/"},"publisher":{"@type":"Organization","name":"Amjad Alsharafi","logo":{"@type":"ImageObject","url":"https://amjad50.github.io/favicon.ico"}}}</script></head><body class=single id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else{if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}}</script><noscript><style type=text/css>.theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://amjad50.github.io/en/>Amjad Alsharafi</a>
<span class=logo-switches><span class=theme-toggle><a id=theme-toggle><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></a></span><span class=lang-switch><span>|</span><ul><li><a href=https://amjad50.github.io/ar/ title=العربية aria-label=العربية>العربية</a></li></ul></span></span></div><ul class=menu id=menu onscroll=menu_on_scroll()><li><a href=https://amjad50.github.io/en/about><span>About</span></a></li><li><a href=https://amjad50.github.io/en/series><span>Series</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>WGMY2020 - RE - kmum</h1><div class=post-meta>December 6, 2020&nbsp;·&nbsp;Amjad</div></header><div class=toc><details open><summary><div class=details>Table of Contents</div></summary><blockquote><ul><li><a href=#introduction>Introduction</a></li><li><a href=#analysis>Analysis</a><ul><li><a href=#appexe-analysis><code>app.exe</code> analysis</a><ul><li><a href=#fun_140001070-analysis><code>FUN_140001070</code> analysis</a></li></ul></li><li><a href=#kmumsys-analysis><code>kmum.sys</code> analysis</a><ul><li><a href=#fun_1400011d0-analysis><code>FUN_1400011d0</code> analysis</a></li><li><a href=#fun_140001810-analysis><code>FUN_140001810</code> analysis</a><ul><li><a href=#fun_140001a90-analysis-stage-2><code>FUN_140001a90</code> analysis (stage 2)</a></li><li><a href=#fun_1400015b0-analysis-stage-3><code>FUN_1400015b0</code> analysis (stage 3)</a></li><li><a href=#fun_1400019b0-analysis-stage-4><code>FUN_1400019b0</code> analysis (stage 4)</a></li><li><a href=#debugging-fun_1400019b0>Debugging <code>FUN_1400019b0</code></a><ul><li><a href=#converting-sys-into-exe>Converting <code>sys</code> into <code>exe</code></a></li></ul></li></ul></li></ul></li><li><a href=#solution>Solution</a></li></ul></li></ul></blockquote></details></div><div class=post-content><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>$ file *
app.exe:  PE32+ executable (console) x86-64, for MS Windows
kmum.sys: PE32+ executable (native) x86-64, for MS Windows
</code></pre></div><h1 id=introduction>Introduction</h1><p>This time we are dealing with kernel drivers.</p><p>I&rsquo;ll be using <a href=https://ghidra.re/>Ghidra</a> and <a href=https://x64dbg.com/>x64dbg</a> for static and dynamic analysis for this challenge.</p><blockquote><p>Note: It is advised to use kernel debugging, but I had some problems in my windows host
so this solution is using static analysis and a small dynamic analysis (not kernel).</p></blockquote><h1 id=analysis>Analysis</h1><p><code>kmum.sys</code> is the driver and <code>app.exe</code> mostly will load the driver and call into it.</p><h2 id=appexe-analysis><code>app.exe</code> analysis</h2><p>The <code>main</code> function is at <code>FUN_140001940</code>. And this time it looks like <code>C++</code> binary, nice.</p><p>The <code>main</code> starts by printing some strings and taking the input from the user, then
<code>FUN_140001070</code> is called.</p><h3 id=fun_140001070-analysis><code>FUN_140001070</code> analysis</h3><p>The function starts by opening the driver <em>file</em> <code>"\\\\.\kmum"</code>, if it fails
it will first get the <code>.sys</code> file by calling <code>FUN_140001780</code> and installing
the driver from the service manager in the function <code>FUN_140001270</code>.</p><p>For <code>FUN_140001270</code> it calls it with <strong>0</strong> in the 3rd argument to stop it and with <strong>1</strong>
to start it again.</p><blockquote><p>I didn&rsquo;t talk much about <code>FUN_140001780</code> and <code>FUN_140001270</code> because they are just bunch of API calls
and have some logging, so they are easy to understand from the code.</p></blockquote><p>Going back to <code>main</code>, the most important part is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C>DeviceIoControl(DAT_1400067d8,<span style=color:#ae81ff>0x222000</span>,local_118,(DWORD)lVar6,local_128,<span style=color:#ae81ff>1</span>,local_124,
                (LPOVERLAPPED)<span style=color:#ae81ff>0x0</span>);
</code></pre></div><p>Looking at the <a href=https://docs.microsoft.com/en-us/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol>documentation for DeviceIoControl</a>:</p><ul><li><code>DAT_1400067d8</code> is a global reference to the driver file.</li><li><code>0x222000</code> is the <code>ioctl</code> code.</li><li><code>local_118</code> input buffer.</li><li><code>lVar6</code> length of input buffer.</li><li><code>local_128</code> output buffer.</li><li><code>1</code> max length of output buffer.</li><li><code>local_124</code> length returned for output.</li></ul><p>Lastly, the output buffer should have the result of the flag check. Now let&rsquo;s go into the driver and see
how the flag check is made.</p><h2 id=kmumsys-analysis><code>kmum.sys</code> analysis</h2><blockquote><p>It&rsquo;s good to look at simple kernel driver examples, to see the similarities and to ease analysis.
<a href=https://www.codeproject.com/Articles/34067/Simple-WDM-LoopBack-Driver>here</a> is a good simple driver we will
be referencing.</p></blockquote><p>Drivers does not have <code>main</code> but have <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/wdf/driverentry-for-kmdf-drivers>DriverEntry</a> which should setup the driver.</p><p>When looking at <code>entry</code> in <a href=https://ghidra.re/>Ghidra</a>, two functions are being called <code>FUN_14000602c</code>
(which seems not important for analysis), and <code>FUN_140001000</code>, which takes the first argument from entry.
<a href=https://ghidra.re/>Ghidra</a> didn&rsquo;t detect the second argument from <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/wdf/driverentry-for-kmdf-drivers>DriverEntry</a> because it is not used.</p><p>In <code>FUN_140001000</code> let&rsquo;s change the parameter type to <code>DRIVER_OBJECT</code>.</p><blockquote><p>Note: if you don&rsquo;t see <code>DRIVER_OBJECT</code> in <a href=https://ghidra.re/>Ghidra</a> you can download data types archives from <a href=https://github.com/NationalSecurityAgency/ghidra/tree/master/Ghidra/Features/Base/data/typeinfo/win32>here</a>.</p></blockquote><p>Here is the function:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C>ulonglong <span style=color:#a6e22e>FUN_140001000</span>(DRIVER_OBJECT <span style=color:#f92672>*</span>param_1)
{
  uint local_48;
  ulonglong local_40;
  undefined8 local_38;
  undefined local_30 [<span style=color:#ae81ff>16</span>];
  undefined local_20 [<span style=color:#ae81ff>32</span>];
  
  local_38 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  DbgPrint(<span style=color:#e6db74>&#34;[*] DriverEntry Called.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
  RtlInitUnicodeString(local_30,<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>Device</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>kmum&#34;</span>);
  RtlInitUnicodeString(local_20,<span style=color:#e6db74>L</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>??</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>kmum&#34;</span>);
  local_48 <span style=color:#f92672>=</span> IoCreateDevice(param_1,<span style=color:#ae81ff>0</span>,local_30,<span style=color:#ae81ff>0x22</span>,<span style=color:#ae81ff>0x100</span>,<span style=color:#ae81ff>0</span>,<span style=color:#f92672>&amp;</span>local_38);
  <span style=color:#66d9ef>if</span> ((<span style=color:#66d9ef>int</span>)local_48 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
    DbgPrint(<span style=color:#e6db74>&#34;[*] There was some errors in creating device.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
  }
  <span style=color:#66d9ef>else</span> {
    local_40 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>while</span> (local_40 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x1b</span>) {
      <span style=color:#f92672>*</span>(code <span style=color:#f92672>**</span>)(param_1<span style=color:#f92672>-&gt;</span>MajorFunction <span style=color:#f92672>+</span> local_40) <span style=color:#f92672>=</span> FUN_140001190;
      local_40 <span style=color:#f92672>=</span> local_40 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
    }
    param_1<span style=color:#f92672>-&gt;</span>MajorFunction[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> (PDRIVER_DISPATCH)<span style=color:#ae81ff>0x140001190</span>;
    <span style=color:#f92672>*</span>(code <span style=color:#f92672>**</span>)param_1<span style=color:#f92672>-&gt;</span>MajorFunction <span style=color:#f92672>=</span> FUN_140001190;
    param_1<span style=color:#f92672>-&gt;</span>MajorFunction[<span style=color:#ae81ff>0xe</span>] <span style=color:#f92672>=</span> (PDRIVER_DISPATCH)<span style=color:#ae81ff>0x1400011d0</span>;
    <span style=color:#f92672>*</span>(code <span style=color:#f92672>**</span>)<span style=color:#f92672>&amp;</span>param_1<span style=color:#f92672>-&gt;</span>DriverUnload <span style=color:#f92672>=</span> FUN_140001260;
    local_48 <span style=color:#f92672>=</span> IoCreateSymbolicLink(local_20,local_30);
    <span style=color:#66d9ef>if</span> ((<span style=color:#66d9ef>int</span>)local_48 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
      DbgPrint(<span style=color:#e6db74>&#34;Failed to create symbolic link (0x%08X)</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,(ulonglong)local_48);
      IoDeleteDevice(local_38);
    }
  }
  <span style=color:#66d9ef>return</span> (ulonglong)local_48;
}
</code></pre></div><p>First it creates the device using <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iocreatedevice>IoCreateDevice</a>, then it sets the handler functions.
Looks like <code>FUN_140001190</code> is being used as handler to all major functions except for
<code>DriverUnload</code> to <code>FUN_140001260</code>, and <code>MajorFunction[0xe]</code> to <code>FUN_1400011d0</code>.</p><p>The function for <code>0xe</code> is <code>IRP_MJ_DEVICE_CONTROL</code>, which matches what <code>app.exe</code> calls. (<code>DeviceIoControl</code>).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#75715e>#define IRP_MJ_DEVICE_CONTROL   0x0e
</span></code></pre></div><h3 id=fun_1400011d0-analysis><code>FUN_1400011d0</code> analysis</h3><p>The function first calls <code>FUN_1400012b0</code>, which looks like <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-iogetcurrentirpstacklocation>IoGetCurrentIrpStackLocation</a>.</p><p>Then it checks the <code>ioctl</code> code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C>stack_io <span style=color:#f92672>=</span> (PIO_STACK_LOCATION)FUN_1400012b0(param_2);
<span style=color:#66d9ef>if</span> (<span style=color:#f92672>*</span>(<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>)(stack_io<span style=color:#f92672>-&gt;</span>Parameters <span style=color:#f92672>+</span> <span style=color:#ae81ff>0x14</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x222000</span>) {
uVar1 <span style=color:#f92672>=</span> FUN_140001810((longlong)param_2);
local_18 <span style=color:#f92672>=</span> (uint)uVar1;
}
</code></pre></div><p><a href=https://ghidra.re/>Ghidra</a> didn&rsquo;t manage to correctly figure out offsets because <code>IO_STACK_LOCATION</code> contains <code>unions</code>, and its hard to analyse.
So <code>stack_io->Parameters + 0x14</code> is <code>stack_io->Parameters.DeviceIoControl.IoControlCode</code>.</p><p>If the code is good it goes to <code>FUN_140001810</code> next:</p><h3 id=fun_140001810-analysis><code>FUN_140001810</code> analysis</h3><p>Here is finally where the flag is checked.</p><p>First it checks input and output buffer sizes:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#66d9ef>if</span> ((<span style=color:#f92672>*</span>(<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>)(stack_io<span style=color:#f92672>-&gt;</span>Parameters <span style=color:#f92672>+</span> <span style=color:#ae81ff>0xc</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x26</span>) <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#f92672>*</span>(<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>)(stack_io<span style=color:#f92672>-&gt;</span>Parameters <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>))
</code></pre></div><p>Which are <code>Parameters.DeviceIoControl.OutputBufferLength</code> and <code>Parameters.DeviceIoControl.InputBufferLength</code> respectively.</p><p>First stage in checking is XORing and shifting the whole flag and checking for a result:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C>xor_result <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
<span style=color:#66d9ef>while</span> (counter <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0x26</span>) {
    xor_result <span style=color:#f92672>=</span> xor_result <span style=color:#f92672>^</span> (<span style=color:#66d9ef>int</span>)input[counter] <span style=color:#f92672>&lt;&lt;</span> (sbyte)((ulonglong)counter <span style=color:#f92672>%</span> <span style=color:#ae81ff>0x20</span>);
    counter <span style=color:#f92672>=</span> counter <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
}
<span style=color:#66d9ef>if</span> (xor_result <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xb2b07026</span>)
</code></pre></div><p>If that passes, there is <strong>3</strong> more stages to go in functions:
<code>FUN_140001a90</code>, <code>FUN_1400015b0</code> and <code>FUN_1400019b0</code>.</p><h4 id=fun_140001a90-analysis-stage-2><code>FUN_140001a90</code> analysis (stage 2)</h4><p>The simplified function code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C>local_18 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x10</span>;
<span style=color:#66d9ef>do</span> {
    <span style=color:#66d9ef>switch</span>(local_18) {
        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>:</span>
            <span style=color:#66d9ef>if</span> ((byte)(inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1b</span>]) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xb</span>) {
                local_18 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x11</span>;
            }
            <span style=color:#66d9ef>else</span> {
                local_18 <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
            }
            <span style=color:#66d9ef>break</span>;
        <span style=color:#75715e>// ... trimmed   
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>9</span><span style=color:#f92672>:</span>
            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
        <span style=color:#75715e>// ... trimmed
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0x10</span><span style=color:#f92672>:</span>
            <span style=color:#66d9ef>if</span> (inp[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>==</span> inp[<span style=color:#ae81ff>0x1a</span>]) {
                local_18 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x16</span>;
            }
            <span style=color:#66d9ef>else</span> {
                local_18 <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>;
            }
            <span style=color:#66d9ef>break</span>;
        <span style=color:#75715e>// ... trimmed
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0x17</span><span style=color:#f92672>:</span>
            <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
        <span style=color:#75715e>// ... trimmed
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>0x20</span><span style=color:#f92672>:</span>
            <span style=color:#75715e>// ... trimmed
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>break</span>;
    }
} <span style=color:#66d9ef>while</span>(true);
</code></pre></div><p>We can see that <code>local_18</code> is <code>state</code> and we should go through all checks and reach <code>state</code> <strong>0x17</strong>.</p><p>These are all checks:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>inp[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>==</span> inp[<span style=color:#ae81ff>0x1a</span>]
inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1f</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x51</span>
inp[<span style=color:#ae81ff>0x1f</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x16</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1b</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x55</span>
inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x16</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>
inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x18</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>7</span>
inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x6c</span>
inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x33</span>
inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x20</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x21</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x50</span>
inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>
inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x18</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x30</span>
inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1b</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xb</span>
inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x20</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>
inp[<span style=color:#ae81ff>0x21</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x5f</span>
inp[<span style=color:#ae81ff>0x20</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x21</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x62</span>
inp[<span style=color:#ae81ff>0x1b</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1c</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>
</code></pre></div><h4 id=fun_1400015b0-analysis-stage-3><code>FUN_1400015b0</code> analysis (stage 3)</h4><p>This is very similar to <code>FUN_140001a90</code> in terms of <code>state</code> logic, but its much simpler and straight forward,
these are the checks performed:</p><pre><code>inp[0] = 0xc2 * -0x6b + -0x73
inp[1] = 0xf2 * -0x6b + -0x73
inp[2] = 0x60 * -0x6b + -0x73
inp[3] = 0x3c * -0x6b + -0x73
inp[4] = 0xb6 * -0x6b + -0x73
inp[0x25] = 0x30 * -0x6b + -0x73
</code></pre><p>Which is <code>"wgmy{}"</code> part. so this is not very interesting.</p><h4 id=fun_1400019b0-analysis-stage-4><code>FUN_1400019b0</code> analysis (stage 4)</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C>longlong <span style=color:#a6e22e>FUN_1400019b0</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>inp)
{
  <span style=color:#66d9ef>char</span> cVar1;
  ulonglong uVar2;
  ulonglong uVar3;
  byte local_28;
  <span style=color:#66d9ef>int</span> counter;
  ulonglong local_10;
  
  local_10 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xf33df4c3c4feb33f</span>;
  counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
  <span style=color:#66d9ef>while</span>( true ) {
    <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0x14</span> <span style=color:#f92672>&lt;</span> counter) {
      <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
    }
    uVar2 <span style=color:#f92672>=</span> FUN_1400020e0(<span style=color:#f92672>&amp;</span>local_10);
    uVar3 <span style=color:#f92672>=</span> FUN_1400020e0(<span style=color:#f92672>&amp;</span>local_10);
    FUN_1400012d0((<span style=color:#66d9ef>int</span>)uVar2);
    local_28 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    <span style=color:#66d9ef>while</span> (local_28 <span style=color:#f92672>&lt;</span> (byte)uVar3) {
      FUN_140001370();
      local_28 <span style=color:#f92672>=</span> local_28 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
    }
    uVar2 <span style=color:#f92672>=</span> FUN_140001370();
    cVar1 <span style=color:#f92672>=</span> inp[counter];
    uVar2 <span style=color:#f92672>=</span> FUN_140002010((byte)uVar2 <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xf</span>);
    <span style=color:#66d9ef>if</span> (cVar1 <span style=color:#f92672>!=</span> (<span style=color:#66d9ef>char</span>)uVar2) <span style=color:#66d9ef>break</span>;
    counter <span style=color:#f92672>=</span> counter <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
  }
  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p><code>FUN_1400020e0</code>, <code>FUN_1400012d0</code>, <code>FUN_140001370</code>, and <code>FUN_140002010</code> all are complex <strong>but</strong> independant of the input, and that means
we can run debug this function and checks <code>uVar2</code> at the end for every loop.</p><blockquote><p>Now, this could be debugged using <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools>windbg</a> in kernel mode, but I got into problems with my windows host, so I struggled in the beginning
of how to debug this, but then I found the solution.</p></blockquote><h4 id=debugging-fun_1400019b0>Debugging <code>FUN_1400019b0</code></h4><p>The good thing about this function and its internal functions is that it does not depend on the input or anything else in fact,
it just uses global variables to store data and do its computation. Which means we can just start execution from here by editing
the <code>RIP</code> (64bit Instruction Pointer) register.</p><p>When trying to start <code>kmum.sys</code> in <a href=https://x64dbg.com/>x64dbg</a> it does not work as it is a kernel driver and not a normal executable.</p><p>We can fix this issue by editing the <code>PE</code> header and fooling <a href=https://x64dbg.com/>x64dbg</a> into believing this is a normal <code>exe</code>.</p><h5 id=converting-sys-into-exe>Converting <code>sys</code> into <code>exe</code></h5><p>Looking in the <a href=https://docs.microsoft.com/en-us/windows/win32/debug/pe-format>PE format</a>, there is a byte to control the <a href=https://docs.microsoft.com/en-us/windows/win32/debug/pe-format#windows-subsystem>subsystem</a> that this binary represent.
The driver has subsystem value of <strong>1</strong>, and the cli executable has value of <strong>3</strong>.</p><p>In our file here, the offset is at <strong>0x134</strong>, so we change that and we can run the driver now.</p><p>When running the driver, first we continue until we reach the entry breakpoint and immediately change
<code>$rip</code> to <code>xxxxxxxxxxxx19B0</code>.</p><p>After that since this function expects a buffer as argument in <code>rcx</code>. We can allocate memory from <a href=https://x64dbg.com/>x64dbg</a>, put a
flag in there (example: <code>wgmy{aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa}</code>) and put the address in <code>rcx</code>.</p><p>Next, we continue until <code>xxxxxxxxxxxx1A70</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>140001a70  cmp ecx,eax
</code></pre></div><p><code>eax</code> should have the correct character, for easier analysis we can patch the jump instruction after it to force
it to jump. It now jumps if they are equal. all we need is convert <code>jz</code> into <code>jmp</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>140001a72  jz LAB_140001a78
</code></pre></div><p>Then we just continue execution and record all <strong>16</strong> characters:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>62a7075ff72176ad
</code></pre></div><h2 id=solution>Solution</h2><p>Now that we have all the pieces,
<a href=#fun_140001a90-analysis-stage-2>stage 2</a>, <a href=#fun_1400019b0-analysis-stage-4>stage 4</a> and the xor thing.
We can solve them using <a href=https://github.com/Z3Prover/z3>z3-solver</a>, which is a <em>theorem prover from Microsoft Research</em>.</p><p>I started by grouping all rules we collected and got this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> z3 <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>

inp <span style=color:#f92672>=</span> [BitVec(f<span style=color:#e6db74>&#39;x{i}&#39;</span>, <span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0x26</span>)]

xor_thing <span style=color:#f92672>=</span> BitVec(<span style=color:#e6db74>&#39;xor&#39;</span>, <span style=color:#ae81ff>32</span>)

s <span style=color:#f92672>=</span> Solver()

<span style=color:#66d9ef>for</span> (i, inpp) <span style=color:#f92672>in</span> enumerate(inp):
    xor_thing <span style=color:#f92672>=</span> xor_thing <span style=color:#f92672>^</span> (inpp <span style=color:#f92672>&lt;&lt;</span> (i <span style=color:#f92672>%</span> <span style=color:#ae81ff>0x20</span>))

    <span style=color:#75715e># because it a byte</span>
    s<span style=color:#f92672>.</span>add(inpp <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>)
    s<span style=color:#f92672>.</span>add(inpp <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0xFF</span>)

<span style=color:#75715e># stage 1</span>
s<span style=color:#f92672>.</span>add(xor_thing <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xb2b07026</span>)

<span style=color:#75715e># stage 2</span>
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>==</span> inp[<span style=color:#ae81ff>0x1a</span>])
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1f</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x51</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x1f</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x16</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1b</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x55</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x16</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x18</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>7</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x6c</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x24</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x33</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x20</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x21</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x50</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x19</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x15</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x18</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x30</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x1d</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1b</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0xb</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x22</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x20</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>6</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x21</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1a</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x23</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x5f</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x20</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x21</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0x62</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x1b</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1c</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x17</span>] <span style=color:#f92672>^</span> inp[<span style=color:#ae81ff>0x1e</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span>)

<span style=color:#75715e># stage 3</span>
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> (<span style=color:#ae81ff>0xc2</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x6b</span> <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x73</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> (<span style=color:#ae81ff>0xf2</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x6b</span> <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x73</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>==</span> (<span style=color:#ae81ff>0x60</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x6b</span> <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x73</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>==</span> (<span style=color:#ae81ff>0x3c</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x6b</span> <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x73</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>==</span> (<span style=color:#ae81ff>0xb6</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x6b</span> <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x73</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>)
s<span style=color:#f92672>.</span>add(inp[<span style=color:#ae81ff>0x25</span>] <span style=color:#f92672>==</span> (<span style=color:#ae81ff>0x30</span> <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x6b</span> <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>0x73</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xFF</span>)

<span style=color:#75715e># stage 4</span>
<span style=color:#66d9ef>for</span> (i, c) <span style=color:#f92672>in</span> enumerate(<span style=color:#e6db74>&#39;62a7075ff72176ad&#39;</span>):
    s<span style=color:#f92672>.</span>add(inp[i <span style=color:#f92672>+</span> <span style=color:#ae81ff>5</span>] <span style=color:#f92672>==</span> ord(c))

<span style=color:#66d9ef>print</span>(s<span style=color:#f92672>.</span>check())

m <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>model()
<span style=color:#66d9ef>print</span>([m[inpp] <span style=color:#66d9ef>for</span> inpp <span style=color:#f92672>in</span> inp])

<span style=color:#75715e># this converts the int array to encoded string using a weird method,</span>
<span style=color:#75715e># this is due to not able to convert from BitVec into integer, BitVec is just</span>
<span style=color:#75715e># a reference</span>
<span style=color:#66d9ef>print</span>(bytes(eval(str([m[inpp] <span style=color:#66d9ef>for</span> inpp <span style=color:#f92672>in</span> inp]))))
</code></pre></div><blockquote><p>Note: the reason we used <code>BitVec(f'x{i}', 32)</code> for each character instead of <strong>8</strong>, is that <code>BitVec</code> of <strong>8</strong>
bits in size cannot be shifted and converted into <strong>32</strong> bit.</p></blockquote><p><strong>BUT</strong>, this gave us:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>wgmy{62a7075ff72176ad+afx(a+c5,y/ac9&#34;}
</code></pre></div><p>And that means the constrains are not enough, so I thought of making the inside only in <code>0-9a-f</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># only hex characters</span>
<span style=color:#66d9ef>if</span> i <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>and</span> i <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x24</span>:
    s<span style=color:#f92672>.</span>add(Or(And(inpp <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0x30</span>, inpp <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x39</span>), And(inpp <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0x66</span>, inpp <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0x61</span>)))
</code></pre></div><p>This replaces:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># because it a byte</span>
s<span style=color:#f92672>.</span>add(inpp <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span>)
s<span style=color:#f92672>.</span>add(inpp <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>0xFF</span>)
</code></pre></div><p>And we got the flag:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>wgmy{62a7075ff72176ad1afb2a1c56c5ac98}
</code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://amjad50.github.io/en/tags/writeup>writeup</a></li><li><a href=https://amjad50.github.io/en/tags/wgmy2020>wgmy2020</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share WGMY2020 - RE - kmum on twitter" href="https://twitter.com/intent/tweet/?text=WGMY2020%20-%20RE%20-%20kmum&url=https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f&hashtags=writeup%2cwgmy2020"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WGMY2020 - RE - kmum on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f&title=WGMY2020%20-%20RE%20-%20kmum&summary=WGMY2020%20-%20RE%20-%20kmum&source=https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WGMY2020 - RE - kmum on reddit" href="https://reddit.com/submit?url=https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f&title=WGMY2020%20-%20RE%20-%20kmum"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zm-119.474 108.193c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zm-160.386-29.702c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WGMY2020 - RE - kmum on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978v-192.915h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WGMY2020 - RE - kmum on whatsapp" href="https://api.whatsapp.com/send?text=WGMY2020%20-%20RE%20-%20kmum%20-%20https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23-13.314-11.876-22.304-26.542-24.916-31.026s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share WGMY2020 - RE - kmum on telegram" href="https://telegram.me/share/url?text=WGMY2020%20-%20RE%20-%20kmum&url=https%3a%2f%2famjad50.github.io%2fen%2fposts%2fwgmy2020%2fkmum%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47A3.38 3.38.0 0126.49 29.86zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2020 <a href=https://amjad50.github.io/en/>Amjad Alsharafi</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo️️</a>️</span>
<span>&#183;</span>
<span>Theme️ <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top"><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script src=https://amjad50.github.io/assets/js/highlight.min.e7afc2928c0925d65c4732dfebe147014d91299a98e819e4b42f25c4fa68e91c.js integrity="sha256-56/CkowJJdZcRzLf6+FHAU2RKZqY6BnktC8lxPpo6Rw="></script><script>hljs.initHighlightingOnLoad();</script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth"});});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>